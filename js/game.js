const canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),cat={x:100,y:100,size:40,color:"#555",inventory:[]},npc={x:400,y:300,size:40,color:"#cc9",message:"Mňau! Hledáš rybičku?"},item={x:600,y:150,size:20,color:"blue",name:"Rybička"},portal={x:700,y:400,size:50,color:"purple"},enemies=[{x:300,y:200,size:30,color:"red",speed:2,direction:1},{x:500,y:100,size:30,color:"red",speed:2,direction:-1}],sword={x:cat.x+20,y:cat.y+20,size:10,color:"silver",active:!1};let keys={},direction={x:0,y:0},message="",messageTimer=0;function showMessage(e){message=e,messageTimer=120}document.addEventListener("keydown",(e=>keys[e.key]=!0)),document.addEventListener("keyup",(e=>keys[e.key]=!1));const joystick=document.getElementById("joystick");let startX,startY,dragging=!1;function update(){(keys.ArrowUp||direction.y<-.5)&&(cat.y-=3),(keys.ArrowDown||direction.y>.5)&&(cat.y+=3),(keys.ArrowLeft||direction.x<-.5)&&(cat.x-=3),(keys.ArrowRight||direction.x>.5)&&(cat.x+=3),Math.abs(cat.x-npc.x)<40&&Math.abs(cat.y-npc.y)<40&&showMessage(npc.message),Math.abs(cat.x-item.x)<30&&Math.abs(cat.y-item.y)<30&&!cat.inventory.includes(item.name)&&(cat.inventory.push(item.name),showMessage("Našla jsi rybičku!")),updateEnemies(),updateSword(),updatePortal()}function updateEnemies(){enemies.forEach((e=>{e.x+=e.speed*e.direction,(e.x<0||e.x>canvas.width-e.size)&&(e.direction*=-1),Math.abs(cat.x-e.x)<30&&Math.abs(cat.y-e.y)<30&&showMessage("Narazila jsi na nepřítele!"),sword.active&&Math.abs(sword.x-e.x)<20&&Math.abs(sword.y-e.y)<20&&(enemies.splice(enemies.indexOf(e),1),showMessage("Nepřítel poražen!"))}))}function updateSword(){sword.x=cat.x+30*direction.x,sword.y=cat.y+30*direction.y,sword.active?0===direction.x&&0===direction.y&&(sword.x=cat.x+30,sword.y=cat.y+10):(sword.x=cat.x+20,sword.y=cat.y+20)}function updatePortal(){Math.abs(cat.x-portal.x)<40&&Math.abs(cat.y-portal.y)<40&&showMessage("Vstupuješ do dalšího levelu!")}function drawCharacter(e){ctx.fillStyle=e.color,ctx.fillRect(e.x,e.y,e.size,e.size),e===cat&&(ctx.fillStyle="#000",ctx.beginPath(),ctx.moveTo(e.x+10,e.y),ctx.lineTo(e.x+20,e.y-15),ctx.lineTo(e.x+30,e.y),ctx.fill(),ctx.beginPath(),ctx.moveTo(e.x+30,e.y),ctx.lineTo(e.x+40,e.y-15),ctx.lineTo(e.x+50,e.y),ctx.fill(),ctx.fillStyle="#fff",ctx.fillRect(e.x+12,e.y+10,5,5),ctx.fillRect(e.x+28,e.y+10,5,5),ctx.fillStyle="#000",ctx.fillRect(e.x+20,e.y+25,4,4))}function drawEnemies(){enemies.forEach((e=>{ctx.fillStyle=e.color,ctx.fillRect(e.x,e.y,e.size,e.size)}))}function drawPortal(){ctx.fillStyle=portal.color,ctx.beginPath(),ctx.arc(portal.x+25,portal.y+25,portal.size/2,0,2*Math.PI),ctx.fill()}function drawSword(){sword.active&&(ctx.fillStyle=sword.color,ctx.fillRect(sword.x,sword.y,sword.size,sword.size))}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),drawCharacter(cat),drawCharacter(npc),cat.inventory.includes(item.name)||(ctx.fillStyle=item.color,ctx.beginPath(),ctx.arc(item.x+10,item.y+10,item.size,0,2*Math.PI),ctx.fill()),messageTimer>0&&(ctx.fillStyle="#000",ctx.font="20px sans-serif",ctx.fillText(message,20,40),messageTimer--),ctx.fillStyle="#000",ctx.font="16px sans-serif",ctx.fillText("Inventář: "+cat.inventory.join(", "),20,canvas.height-20),drawEnemies(),drawPortal(),drawSword()}function gameLoop(){update(),draw(),requestAnimationFrame(gameLoop)}joystick.addEventListener("touchstart",(e=>{dragging=!0;const t=e.touches[0];startX=t.clientX,startY=t.clientY,direction={x:0,y:0},sword.active=!0})),joystick.addEventListener("touchmove",(e=>{if(!dragging)return;e.preventDefault();const t=e.touches[0],i=t.clientX-startX,a=t.clientY-startY,c=40,o=Math.sqrt(i*i+a*a);if(o>c){const e=c/o;direction.x=i*e/c,direction.y=a*e/c}else direction.x=i/c,direction.y=a/c})),joystick.addEventListener("touchend",(()=>{dragging=!1,direction={x:0,y:0},sword.active=!1})),gameLoop();